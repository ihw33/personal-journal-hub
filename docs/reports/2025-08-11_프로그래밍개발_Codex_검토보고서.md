# 프로그래밍 개발 상태 검토 보고서 (Codex CLI)

- 일자: 2025-08-11
- 담당: Codex CLI
- 관련 이슈: https://github.com/ihw33/personal-journal-hub/issues/57

## 1. 종합 평가 (10점 만점)

- 현재 상태: 7.5/10
- 근거 요약:
  - Next.js(App Router), TS, Tailwind 기반 구조가 깔끔히 정리됨(`src/app`, `src/components`, `src/lib`, `src/types`).
  - AI 엔진(`src/lib/ai/archi-engine.ts`) 존재, OpenAI 연동 + 로컬 폴백 로직 준비됨.
  - 보안 헤더(CSP 등) 설정 존재(`next.config.ts`) 및 인증 미들웨어 구성(`middleware.ts`).
  - 다만 실행 환경/문서 불일치(포트), 문서 내 관리자 비밀번호 표기, 일부 타입 안전성 미흡(any 다수) 등이 관찰됨.

## 2. 주요 발견사항 Top 3

1) 실행/문서 불일치 및 보안 관련 개선 필요
   - `package.json` dev 포트: `3005`, `README.md` 실행 예시: `3000` → 일관성 필요.
   - `README.md`에 관리자 비밀번호(`admin123`) 노출 → 예시로만 유지하되 실제 값은 환경변수로 관리 권장.
   - 로그 파일(`dev-server.log`, `server.log`)이 루트에 존재 → `.gitignore`에 `*.log` 추가 권장.

2) AI 엔진은 기초 구현 충실, 타입/결정론 보완 여지
   - 파일: `src/lib/ai/archi-engine.ts`
   - 장점: 8단계 사고 패턴 템플릿, DOMPurify 적용, OpenAI 연동 + 로컬 폴백.
   - 개선: 일부 함수 파라미터가 `any` 사용(예: `generateGuidedResponse`, `generateSelfDirectedResponse` 등) → 인터페이스 도입 필요.
   - 응답 선택에 `Math.random()` 기반 비결정 요소 다수 → 테스트/재현성 위해 시드/옵션 기반 결정론 모드 필요.

3) 보안 헤더(CSP) 완화 설정 재검토 필요
   - `next.config.ts`에서 `script-src 'unsafe-eval' 'unsafe-inline'` 허용 → 개발/디버그 편의용으로 보이며, 배포용 프로파일에서 제한 강화 필요.
   - `connect-src 'self' https:` 등 기본 가드는 있으나, 환경별로 분리 구성 권장.

## 3. 긴급 대응 필요사항

- 문서 내 관리자 비밀번호 노출 제거 → 환경변수(`ADMIN_PASSWORD` 등) 의존 + README에는 예시 문구로만 표기.
- 포트 불일치 정정 → `dev` 스크립트 또는 README를 하나로 통일(예: 3000 또는 3005).
- `.gitignore`에 `*.log` 추가, 기존 로그 파일은 추적 제외 처리.
- 노출된 토큰/시크릿 점검(원격 URL 내 포함 토큰 등) 및 즉시 폐기(이미 원격 토큰 URL은 정리 완료).

## 4. 개선 로드맵 제안

단기(1주)
- 실행 환경 일관화: `package.json` ↔ `README.md` 포트/명령어 통일.
- 관리자 비밀번호 환경변수화, 관련 페이지/미들웨어 반영.
- `.gitignore` 갱신(`*.log`) 및 레포 위생 정리.
- AI 엔진 타입 보강: `ArchiContext`, 응답/분석 구조 인터페이스 명확화, `any` 제거.
- 결정론 옵션 추가: `AI_CONFIG`에 `deterministic`/`seed` 옵션 도입, 테스트 유리한 경로 제공.

중기(2주)
- 성능: 라우트 단위 dynamic import, 이미지 최적화(next/image `sizes`, `priority` 점검), 불필요 의존성 정리.
- 데이터 패턴: RSC/SWR 규칙 정리, 페이지네이션/무한스크롤 표준화.
- 보안: 환경별 CSP 프로파일(개발/배포 분리), 인증 레이트리밋 연결(현재 in-memory → Upstash/Redis 전환 고려).
- 테스트: AI 유틸/파서 유닛테스트, 미들웨어/헤더 스냅샷 테스트 도입.

## 5. 근거 및 참고

- 구조: `src/app`, `src/components`, `src/lib`, `src/types` 정리 양호.
- AI 엔진: `src/lib/ai/archi-engine.ts`(OpenAI 연동 + 로컬 폴백, 패턴/토픽/분석 포함).
- API 라우트: `src/app/api/*`(Stripe, 베타 신청 등) 존재.
- 보안 헤더: `next.config.ts`에 CSP/XFO/XCTO/Referrer/Permissions 설정.
- 미들웨어: `middleware.ts` Supabase 세션 기반 보호 라우트 구성.
- 실행 불일치: `package.json` dev(3005) vs `README.md` 실행 예시(3000).
- 문서 민감 정보: `README.md`의 관리자 비밀번호 예시 표기.

## 6. 제안된 다음 액션(실행 가능 항목)

- PR A: `[Round2][Codex] DX/문서 정리` — 포트 일관화, README 갱신, .gitignore에 `*.log` 추가.
- PR B: `[Round2][Codex] 보안/환경변수화` — 관리자 비번 env로 이관, 관련 코드/페이지 수정.
- PR C: `[Round2][Codex] AI 타입 보강` — archi-engine 타입 정리 및 결정론 옵션 추가.
- PR D: `[Round2][Codex] CSP 프로파일링` — dev/serve/preview/prod 별 헤더 분리/강화.

---

본 보고서는 이슈 #57 요구사항(상태 평가·발견사항·긴급 대응·로드맵)에 맞춰 1차 진단 결과를 요약했습니다. 확인 후 우선순위를 확정해 주시면, 제안된 PR 단위로 작업을 쪼개어 순차 제출하겠습니다.

