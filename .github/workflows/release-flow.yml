# .github/workflows/release-flow.yml

name: IWL Release Flow

on:
  pull_request:
    types: [opened]
  push:
    branches:
      - main

jobs:
  # ìƒˆë¡œìš´ PRì´ ìƒì„±ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…
  notify-slack-on-pr:
    # "on.pull_request" ì´ë²¤íŠ¸ì¼ ë•Œë§Œ ì´ jobì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_USERNAME: "IWL-Bot"
          SLACK_ICON_EMOJI: ":robot_face:"
          SLACK_COLOR: "#7C3AED"
          SLACK_TITLE: "ğŸ“¬ New Pull Request Ready for Review!"
          SLACK_MESSAGE: |
            PMë‹˜, ìƒˆë¡œìš´ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë¦¬ë·°ë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”.
            *PR Link:* ${{ github.event.pull_request.html_url }}

  # main ë¸Œëœì¹˜ì— ìƒˆë¡œìš´ ì½”ë“œê°€ push(merge)ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…
  create-release-notes:
    # "on.push" ì´ë²¤íŠ¸ì´ê³ , main ë¸Œëœì¹˜ì¼ ë•Œë§Œ ì´ jobì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          # ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ìƒì„±ì„ ìœ„í•´ ì „ì²´ git íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
          fetch-depth: 0

      - name: Generate Release Notes
        id: release
        uses: release-drafter/release-drafter@v5
        with:
          # ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  GitHub Releases í˜ì´ì§€ì— ì´ˆì•ˆì„ ì‘ì„±í•©ë‹ˆë‹¤.
          config-name: release-drafter.yml
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Send Release Slack Notification
        if: steps.release.outputs.tag_name != '' # ìƒˆ ë¦´ë¦¬ì¦ˆê°€ ìƒì„±ë˜ì—ˆì„ ë•Œë§Œ ì‹¤í–‰
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_USERNAME: "IWL-Bot"
          SLACK_ICON_EMOJI: "ğŸ‰"
          SLACK_COLOR: "#10B981" # Success Green
          SLACK_TITLE: "ğŸš€ New Release Published: ${{ steps.release.outputs.tag_name }}"
          SLACK_MESSAGE: |
            ìƒˆë¡œìš´ ë²„ì „ì´ ì„±ê³µì ìœ¼ë¡œ ë¦´ë¦¬ì¦ˆë˜ì—ˆìŠµë‹ˆë‹¤!
            *Release Notes:* ${{ steps.release.outputs.html_url }}